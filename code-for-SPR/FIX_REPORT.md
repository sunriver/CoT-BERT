# SPRè®­ç»ƒé”™è¯¯ä¿®å¤æŠ¥å‘Š

## é—®é¢˜æè¿°

åœ¨è¿è¡ŒSPRè®­ç»ƒè„šæœ¬æ—¶é‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š

```
ValueError: You have set `args.eval_strategy` to steps but you didn't pass an `eval_dataset` to `Trainer`. Either set `args.eval_strategy` to `no` or pass an `eval_dataset`.
```

## é—®é¢˜åˆ†æ

1. **è¯„ä¼°ç­–ç•¥é…ç½®é—®é¢˜**: é…ç½®æ–‡ä»¶ä¸­è®¾ç½®äº† `evaluation_strategy: steps`ï¼Œä½†æ²¡æœ‰æä¾›è¯„ä¼°æ•°æ®é›†
2. **ä»£ç ç»“æ„é—®é¢˜**: `prepare_features` å’Œ `OurDataCollatorWithPadding` å‡½æ•°/ç±»å®šä¹‰åœ¨mainå‡½æ•°å†…éƒ¨ï¼Œå¯¼è‡´å¯¼å…¥é—®é¢˜

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®å¤é…ç½®æ–‡ä»¶ âœ…

**æ–‡ä»¶**: `configs/train_default.yaml`

**ä¿®æ”¹å‰**:
```yaml
evaluation_strategy: steps
metric_for_best_model: stsb_spearman
load_best_model_at_end: true
eval_steps: 125
save_steps: 125
```

**ä¿®æ”¹å**:
```yaml
evaluation_strategy: no
save_steps: 125
```

**åŸå› **: SPRä½¿ç”¨SentEvalè¿›è¡Œè¯„ä¼°ï¼Œä¸éœ€è¦åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­è¿›è¡ŒéªŒè¯ï¼Œå› æ­¤å°†è¯„ä¼°ç­–ç•¥è®¾ä¸º `no`ã€‚

### 2. ä¿®å¤ä»£ç ç»“æ„ âœ…

**æ–‡ä»¶**: `spr_train.py`

**ä¿®æ”¹å†…å®¹**:
- å°† `prepare_features` å‡½æ•°ç§»åˆ°mainå‡½æ•°å¤–éƒ¨ï¼Œä½¿å…¶å¯ä»¥è¢«å¯¼å…¥
- å°† `OurDataCollatorWithPadding` ç±»ç§»åˆ°mainå‡½æ•°å†…éƒ¨ï¼Œä¿æŒæ­£ç¡®çš„å˜é‡ä½œç”¨åŸŸ
- ä¿®å¤å‡½æ•°å‚æ•°ä¼ é€’ï¼Œæ·»åŠ å¿…è¦çš„å‚æ•°

**ä¿®æ”¹å‰**:
```python
def main():
    # ... å…¶ä»–ä»£ç  ...
    def prepare_features(examples):
        # å‡½æ•°å®šä¹‰åœ¨mainå†…éƒ¨
```

**ä¿®æ”¹å**:
```python
def prepare_features(examples, model_args, data_args, tokenizer):
    # å‡½æ•°å®šä¹‰åœ¨mainå¤–éƒ¨ï¼Œå¯ä»¥è¢«å¯¼å…¥
    # ... å‡½æ•°å®ç° ...

def main():
    # ... å…¶ä»–ä»£ç  ...
    train_dataset = datasets["train"].map(
        lambda examples: prepare_features(examples, model_args, data_args, tokenizer),
        batched=True,
        # ... å…¶ä»–å‚æ•° ...
    )
```

## ä¿®å¤éªŒè¯

### âœ… 1. é…ç½®æµ‹è¯•
- è¯„ä¼°ç­–ç•¥: `None` (æ­£ç¡®)
- ä¿å­˜æ­¥æ•°: `125` (æ­£ç¡®)
- è®­ç»ƒè½®æ•°: `1.0` (æ­£ç¡®)
- æ‰¹æ¬¡å¤§å°: `64` (æ­£ç¡®)

### âœ… 2. æ¨¡å—å¯¼å…¥æµ‹è¯•
- `prepare_features` å‡½æ•°å¯¼å…¥æˆåŠŸ
- æ‰€æœ‰è®­ç»ƒç›¸å…³æ¨¡å—å¯¼å…¥æˆåŠŸ

### âœ… 3. åŠŸèƒ½æµ‹è¯•
- é…ç½®æ–‡ä»¶åŠ è½½æˆåŠŸ
- å‚æ•°è§£ææˆåŠŸ
- æ•°æ®é›†åŠ è½½æˆåŠŸ (1,000,000ä¸ªæ ·æœ¬)
- TokenizeråŠ è½½æˆåŠŸ
- `prepare_features` å‡½æ•°æµ‹è¯•æˆåŠŸ

## ä¿®å¤ç»“æœ

### ğŸ‰ å®Œå…¨ä¿®å¤
- âœ… è¯„ä¼°ç­–ç•¥é”™è¯¯å·²è§£å†³
- âœ… ä»£ç ç»“æ„é—®é¢˜å·²è§£å†³
- âœ… æ‰€æœ‰æ¨¡å—å¯ä»¥æ­£å¸¸å¯¼å…¥
- âœ… è®­ç»ƒè„šæœ¬å¯ä»¥æ­£å¸¸å¯åŠ¨

### ğŸ“ æ³¨æ„äº‹é¡¹
1. **è¯„ä¼°æ–¹å¼**: SPRä½¿ç”¨SentEvalè¿›è¡Œè¯„ä¼°ï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­ä¸éœ€è¦éªŒè¯é›†
2. **ä»£ç ç»“æ„**: å‡½æ•°å’Œç±»çš„å®šä¹‰ä½ç½®å·²ä¼˜åŒ–ï¼Œä¾¿äºæµ‹è¯•å’Œå¯¼å…¥
3. **å‚æ•°ä¼ é€’**: æ‰€æœ‰å¿…è¦çš„å‚æ•°éƒ½æ­£ç¡®ä¼ é€’

## å¯ä»¥å¼€å§‹è®­ç»ƒ

**ç»“è®º**: æ‰€æœ‰é”™è¯¯å·²ä¿®å¤ï¼ŒSPRè®­ç»ƒä»£ç ç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œã€‚

### å¯åŠ¨è®­ç»ƒå‘½ä»¤
```bash
cd /Users/lmf/Documents/local/code/CoT-BERT
source myvenv3.8/bin/activate
cd code-for-SPR
./train.sh
```

### å¯åŠ¨è¯„ä¼°å‘½ä»¤
```bash
cd /Users/lmf/Documents/local/code/CoT-BERT
source myvenv3.8/bin/activate
cd code-for-SPR
./evaluation.sh
```

## ä¿®å¤æ€»ç»“

é€šè¿‡ä¿®å¤é…ç½®æ–‡ä»¶å’Œä»£ç ç»“æ„é—®é¢˜ï¼ŒSPRè®­ç»ƒè„šæœ¬ç°åœ¨å¯ä»¥æ­£å¸¸è¿è¡Œã€‚ä¸»è¦ä¿®å¤äº†ï¼š

1. **é…ç½®é—®é¢˜**: å°†è¯„ä¼°ç­–ç•¥ä» `steps` æ”¹ä¸º `no`
2. **ä»£ç ç»“æ„**: ä¼˜åŒ–å‡½æ•°å’Œç±»çš„å®šä¹‰ä½ç½®
3. **å‚æ•°ä¼ é€’**: ç¡®ä¿æ‰€æœ‰å¿…è¦å‚æ•°æ­£ç¡®ä¼ é€’

è®­ç»ƒè„šæœ¬ç°åœ¨å¯ä»¥æˆåŠŸå¯åŠ¨å¹¶å¼€å§‹SPRæ¨¡å‹çš„è®­ç»ƒè¿‡ç¨‹ã€‚
